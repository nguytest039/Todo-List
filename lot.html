<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<link rel="stylesheet" href="/production-system/assets/plugins/daterangepicker/daterangepicker.css" />
<script src="/production-system/assets/plugins/jquery/jquery.min.js"></script>
<script src="/production-system/assets/plugins/daterangepicker/moment.min.js"></script>
<script src="/production-system/assets/plugins/daterangepicker/daterangepicker.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>

<style>
    .component-wrapper {
        /* border: 1px solid green; */
        padding: 0.35rem 0.35rem;
    }

    .component-item {
        height: 100%;
        padding: 0.5rem 0.75rem;
        background-color: rgba(73, 146, 255, 0.15);
        box-shadow: 0 3px 17px #030616;
        border-radius: 0.3rem;
        overflow: hidden;
        display: flex;
        justify-content: flex-start;
        flex-direction: column;
        -webkit-border-radius: 0.3rem;
        -moz-border-radius: 0.3rem;
        -ms-border-radius: 0.3rem;
        -o-border-radius: 0.3rem;
    }

    .component-item .chart-box {
        height: 25vh;
    }

    .component-item .table-box {
        height: 25vh;
    }

    .component-item .info-box {
        height: 6vh;
        background-color: rgba(73, 146, 255, 0.15);
    }

    .component-title {
        font-size: 1.12rem;
        margin: 0;
        padding-bottom: 0.5rem;
    }

    .text-span {
        font-size: 1.12rem;
    }

    .table-responsive::-webkit-scrollbar {
        width: 5px;
    }

    .table-responsive::-webkit-scrollbar-thumb {
        background-color: #264b8b;
    }

    .table {
        --border-color: #6290b5;
        margin-bottom: 0;
        border-right: 1px solid #37567f;
        border-top: 1px solid #37567f;
    }

    .table thead {
        position: sticky;
        top: 0;
    }

    .table th,
    .table td {
        text-align: center;
        vertical-align: middle;
        color: #fff;
        border: none;
        box-shadow: inset 0.5px -0.5px 0px var(--border-color);
        font-weight: normal;
        line-height: 1.2;
    }

    .table thead th {
        font-size: 0.9rem;
        background-color: #264b8b;
        font-size: 0.9rem;
    }

    .table tbody td {
        font-size: 0.8rem;
        background-color: transparent;
    }
    /* 
.table-striped > tbody > tr:nth-of-type(odd) > * {
    background-color: #264e9256;
} */

    .table-striped > tbody > tr.odd {
        background-color: #264e9256;
    }

    .table tbody td.grand-value {
        /* color: #5e9fff; */
        color: #03a9f4;
    }

    select[name="sl-option"] {
        cursor: pointer;
    }

    select[name="sl-option"]:focus,
    select[name="sl-option"]:focus-visible {
        outline: 0;
        box-shadow: none;
    }

    select[name="sl-option"] option {
        background: #0c1b40;
        color: #fff;
    }
</style>

<div class="container-fluid">
    <spring:message code="vietnamese" var="vietnamese" />
    <spring:message code="chinese" var="chinese" />
    <spring:message code="english" var="english" />
    <spring:message code="profile" var="profile" />
    <spring:message code="logout" var="logout" />

    <jsp:include page="/WEB-INF/jsp/common/header-dashboard.jsp">
        <jsp:param name="titlePage" value="Apollo & Rhea IQC Inspection Report" />
        <jsp:param name="subTitlePage" value="" />
        <jsp:param name="vietnamese" value="<%=pageContext.getAttribute(\"vietnamese\") %>" /> <jsp:param name="chinese"
        value="<%= pageContext.getAttribute(\"chinese\") %>" /> <jsp:param name="english" value="<%=
        pageContext.getAttribute(\"english\") %>" /> <jsp:param name="profile"
        value="<%=pageContext.getAttribute(\"profile\") %>" /> <jsp:param name="logout" value="<%=
        pageContext.getAttribute(\"logout\") %>" />
    </jsp:include>

    <div class="container-fluid px-0 content-wrapper">
        <div class="row">
            <div class="col-md-3 component-wrapper">
                <div class="component-item">
                    <h5 class="component-title">Inspected Distribution by Material Type</h5>
                    <div class="component-body chart-box" id="donut-chart-1"></div>
                </div>
            </div>

            <div class="col-md-9 component-wrapper">
                <div class="row">
                    <h5 class="component-title">Lot Rejected Rate</h5>
                    <div class="component-body">
                        <div class="col-md-4 component-wrapper">
                            <div class="component-item d-flex justify-content-center align-items-center text-center">
                                <div class="component-title">Inspected</div>
                                <span id="inspected" class="fw-bold text-warning text-span">175</span>
                            </div>
                        </div>

                        <div class="col-md-4 component-wrapper">
                            <div class="component-item d-flex justify-content-center align-items-center text-center">
                                <div class="component-title">Lot Rejected</div>
                                <span id="lot-rejected" class="fw-bold text-warning text-span">5</span>
                            </div>
                        </div>

                        <div class="col-md-4 component-wrapper">
                            <div class="component-item d-flex justify-content-center align-items-center text-center">
                                <div class="component-title">LRR</div>
                                <span id="lrr" class="fw-bold text-warning text-span">2.86%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 component-wrapper">
                        <div class="component-item">
                            <h5 class="component-title">LLR By Weeks</h5>
                            <div class="component-body chart-box" id="col-chart-1"></div>
                        </div>
                    </div>

                    <div class="col-md-6 component-wrapper">
                        <div class="component-item">
                            <h5 class="component-title">LLR Last 7 Days</h5>
                            <div class="component-body chart-box" id="col-chart-2"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ROW 2 -->
        <div class="row">
            <div class="col-md-3 component-wrapper">
                <div class="component-item">
                    <h5 class="component-title">CPN Status</h5>

                    <div class="component-body">
                        <div class="row">
                            <div class="col-md-6 component-wrapper">
                                <div
                                    class="component-item d-flex flex-column justify-content-center align-items-center text-center">
                                    <div class="component-title">To Be Inspected</div>
                                    <span id="inspected" class="fw-bold text-warning text-span">3059</span>
                                </div>
                            </div>

                            <div class="col-md-6 component-wrapper">
                                <div
                                    class="component-item d-flex flex-column justify-content-center align-items-center text-center">
                                    <div class="component-title">Timeout Inspected</div>
                                    <span id="lot-rejected" class="fw-bold text-warning text-span">700</span>
                                </div>
                            </div>

                            <div class="col-md-6 component-wrapper">
                                <div
                                    class="component-item d-flex flex-column justify-content-center align-items-center text-center">
                                    <div class="component-title">To Be Scanned</div>
                                    <span id="lrr" class="fw-bold text-warning text-span">2110</span>
                                </div>
                            </div>

                            <div class="col-md-6 component-wrapper">
                                <div
                                    class="component-item d-flex flex-column justify-content-center align-items-center text-center">
                                    <div class="component-title">Timeout Scanned</div>
                                    <span id="lrr" class="fw-bold text-warning text-span">1024</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h5 class="component-title mt-3">NCMR Status</h5>
                    <div class="component-body chart-box" id="donut-chart-2"></div>
                </div>
            </div>

            <div class="col-md-9 component-wrapper">
                <div class="component-item">
                    <div class="row">
                        <div class="col-md-4 component-wrapper">
                            <h5 class="component-title">Lot Rejected By Material Type</h5>
                            <div class="component-body chart-box" id="col-chart-3"></div>
                        </div>

                        <div class="col-md-4 component-wrapper">
                            <h5 class="component-title">Top Lot Rejected By MFR</h5>
                            <div class="component-body chart-box" id="col-chart-4"></div>
                        </div>

                        <div class="col-md-4 component-wrapper">
                            <h5 class="component-title">Top Lot Rejected By Models</h5>
                            <div class="component-body chart-box" id="col-chart-5"></div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4 component-wrapper">
                            <h5 class="component-title">Details</h5>
                            <div class="component-body table-box">
                                <div class="table-responsive">
                                    <table class="table table-sm table-striped" id="table-1">
                                        <thead>
                                            <tr>
                                                <th>Material Type</th>
                                                <th>MRF Code</th>
                                                <th>MFR Name</th>
                                                <th>Num. of records</th>
                                            </tr>
                                        </thead>

                                        <tbody>
                                            <tr>
                                                <td>MECHANICAL</td>
                                                <td>YE00034810</td>
                                                <td>YAGEO USA (HK) CO,</td>
                                                <td>21</td>
                                            </tr>
                                            <tr>
                                                <td>PASSIVE</td>
                                                <td>YE00034810</td>
                                                <td>YAGEO USA (HK) CO,</td>
                                                <td>15</td>
                                            </tr>

                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>

                                            <!-- thêm 10 dòng -->
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4 component-wrapper">
                            <h5 class="component-title">Details</h5>
                            <div class="component-body table-box">
                                <div class="table-responsive">
                                    <table class="table table-sm table-striped" id="table-2">
                                        <thead>
                                            <tr>
                                                <th>Material Type</th>
                                                <th>MRF Code</th>
                                                <th>MFR Name</th>
                                                <th>Num. of records</th>
                                            </tr>
                                        </thead>

                                        <tbody>
                                            <tr>
                                                <td>MECHANICAL</td>
                                                <td>YE00034810</td>
                                                <td>YAGEO USA (HK) CO,</td>
                                                <td>21</td>
                                            </tr>
                                            <tr>
                                                <td>PASSIVE</td>
                                                <td>YE00034810</td>
                                                <td>YAGEO USA (HK) CO,</td>
                                                <td>15</td>
                                            </tr>

                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>

                                            <!-- thêm 10 dòng -->
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4 component-wrapper">
                            <h5 class="component-title">Details</h5>
                            <div class="component-body table-box">
                                <div class="table-responsive">
                                    <table class="table table-sm table-striped" id="table-3">
                                        <thead>
                                            <tr>
                                                <th>Material Type</th>
                                                <th>MRF Code</th>
                                                <th>MFR Name</th>
                                                <th>Num. of records</th>
                                            </tr>
                                        </thead>

                                        <tbody>
                                            <tr>
                                                <td>MECHANICAL</td>
                                                <td>YE00034810</td>
                                                <td>YAGEO USA (HK) CO,</td>
                                                <td>21</td>
                                            </tr>
                                            <tr>
                                                <td>PASSIVE</td>
                                                <td>YE00034810</td>
                                                <td>YAGEO USA (HK) CO,</td>
                                                <td>15</td>
                                            </tr>

                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>

                                            <!-- thêm 10 dòng -->
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                            <tr>
                                                <td>Cell Text</td>
                                                <td>Cell Text</td>
                                                <td>Cell Texts</td>
                                                <td>Cell Texts</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ROW 3 -->
        <div class="row">
            <div class="col-md-6 component-wrapper">
                <div class="component-item">
                    <h5 class="component-title">NCMR List</h5>
                    <div class="component-body table-box" id="table-4">
                        <div class="table-responsive">
                            <table class="table table-sm table-striped" id="table-4">
                                <thead>
                                    <tr>
                                        <th>NCMR_NO</th>
                                        <th>DOC_NO</th>
                                        <th>CASE_OWNER</th>
                                        <th>DEPARTMENT</th>
                                        <th>Title</th>
                                        <th>INSPECTION_I</th>
                                        <th>REJECT_REASON</th>
                                        <th>IMPROVEMENT</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>NCMR2511<br />0610525601</td>
                                        <td>251106105256</td>
                                        <td>TRAN THI HUE<br />(31464)</td>
                                        <td>IQC</td>
                                        <td>Cell Texts</td>
                                        <td>2025-11-06</td>
                                        <td>Cosmetic issue: NG NGOAI QUAN BON G KEO</td>
                                        <td>N/A</td>
                                    </tr>

                                    <tr>
                                        <td>Cell Text</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                    </tr>

                                    <tr>
                                        <td>Cell Text</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                    </tr>
                                    <tr>
                                        <td>Cell Text</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                    </tr>
                                    <tr>
                                        <td>Cell Text</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                    </tr>
                                    <tr>
                                        <td>Cell Text</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                    </tr>
                                    <tr>
                                        <td>Cell Text</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                    </tr>
                                    <tr>
                                        <td>Cell Text</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                    </tr>
                                    <tr>
                                        <td>Cell Text</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                    </tr>
                                    <tr>
                                        <td>Cell Text</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                    </tr>
                                    <tr>
                                        <td>Cell Text</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                    </tr>
                                    <tr>
                                        <td>Cell Text</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                    </tr>
                                    <tr>
                                        <td>Cell Text</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6 component-wrapper">
                <div class="component-item">
                    <h5 class="component-title">Inspection List</h5>
                    <div class="component-body table-box" id="table-5">
                        <div class="table-responsive">
                            <table class="table table-sm table-striped" id="table-5">
                                <thead>
                                    <tr>
                                        <th>NCMR_NO</th>
                                        <th>DOC_NO</th>
                                        <th>CASE_OWNER</th>
                                        <th>DEPARTMENT</th>
                                        <th>Title</th>
                                        <th>INSPECTION_I</th>
                                        <th>REJECT_REASON</th>
                                        <th>IMPROVEMENT</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>NCMR2511<br />0610525601</td>
                                        <td>251106105256</td>
                                        <td>TRAN THI HUE<br />(31464)</td>
                                        <td>IQC</td>
                                        <td>Cell Texts</td>
                                        <td>2025-11-06</td>
                                        <td>Cosmetic issue: NG NGOAI QUAN BON G KEO</td>
                                        <td>N/A</td>
                                    </tr>

                                    <tr>
                                        <td>Cell Text</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                    </tr>

                                    <tr>
                                        <td>Cell Text</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                    </tr>
                                    <tr>
                                        <td>Cell Text</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                    </tr>
                                    <tr>
                                        <td>Cell Text</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                    </tr>
                                    <tr>
                                        <td>Cell Text</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                    </tr>
                                    <tr>
                                        <td>Cell Text</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                    </tr>
                                    <tr>
                                        <td>Cell Text</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                    </tr>
                                    <tr>
                                        <td>Cell Text</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                    </tr>
                                    <tr>
                                        <td>Cell Text</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                    </tr>
                                    <tr>
                                        <td>Cell Text</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                    </tr>
                                    <tr>
                                        <td>Cell Text</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                    </tr>
                                    <tr>
                                        <td>Cell Text</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                        <td>Cell Texts</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const dataset = {};
    const chartsList = [];

    const getMfrData = (fromDate = "", toDate = "") => {
        const key = `${fromDate}|${toDate}`;

        if (!dataset.mfrCache) {
            dataset.mfrCache = {};
        }

        if (!dataset.mfrCache[key]) {
            dataset.mfrCache[key] = fetchTopRejectData("mfr", 0, 20, fromDate, toDate);
        }

        return dataset.mfrCache[key];
    };

    // ==================== API FUNCTIONS ====================
    const fetchTopRejectData = async (fieldName, page = 0, size = 20, fromDate = "", toDate = "") => {
        try {
            const params = new URLSearchParams({
                fieldName: fieldName,
                page: page.toString(),
                size: size.toString(),
            });

            if (fromDate) params.append("FromDate", fromDate);
            if (toDate) params.append("toDate", toDate);

            const response = await fetch(`/api/iqc/top-reject?${params.toString()}`);

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const json = await response.json();
            return json.data || [];
        } catch (error) {
            console.error(`Error fetching top reject data for ${fieldName}:`, error);
            return [];
        }
    };

    // ==================== DATA PROCESSING FUNCTIONS ====================
    const sortDataByRecord = (data, sortKey = "numberRecord") => {
        return [...data].sort((a, b) => (b[sortKey] || 0) - (a[sortKey] || 0));
    };

    const getTopRecords = (data, limit = 10) => {
        return data.slice(0, limit);
    };

    const prepareColumnChartData = (data, labelKey, valueKey = "numberRecord") => {
        const categories = data.map((item) => item[labelKey] || "N/A");
        const values = data.map((item) => item[valueKey] || 0);
        return {categories, values};
    };

    const prepareDonutChartData = (data, nameKey = "materialType", valueKey = "totalRecord") => {
        const chartData = data.map((item) => ({
            name: item[nameKey] || "N/A",
            y: item[valueKey] || 0,
        }));
        const total = data.reduce((sum, item) => sum + (item[valueKey] || 0), 0);
        return {chartData, total};
    };

    const mapTableData = (data, mapping = {}) => {
        return data.map((item) => {
            const mapped = {...item};
            Object.keys(mapping).forEach((targetKey) => {
                const sourceKey = mapping[targetKey];
                if (sourceKey === null) {
                    mapped[targetKey] = "";
                } else {
                    mapped[targetKey] = item[sourceKey] || "";
                }
            });
            return mapped;
        });
    };

    // ==================== RENDER FUNCTIONS ====================
    const createColumnChartConfig = (categories, values, options = {}) => {
        const {title = "", color = "rgba(92,124,255,0.6)", maxCategories = 10, rotation = -45} = options;
        const displayCategories = categories.slice(0, maxCategories);
        const displayValues = values.slice(0, maxCategories);

        return {
            chart: {
                type: "column",
                backgroundColor: "transparent",
                spacing: [10, 5, 5, 5],
            },
            title: {text: title},
            xAxis: {
                categories: displayCategories,
                labels: {
                    style: {
                        fontSize: "0.8rem",
                        color: "#7a95c3",
                    },
                    rotation: rotation,
                },
            },
            yAxis: {
                title: {text: null},
                labels: {
                    style: {
                        fontSize: "1rem",
                        fontWeight: "600",
                        color: "#7a95c3",
                    },
                },
            },
            tooltip: {
                pointFormat: "<b>{point.y}</b>",
            },
            plotOptions: {
                column: {
                    borderWidth: 0,
                    dataLabels: {
                        enabled: true,
                        style: {
                            color: "#fff",
                            textOutline: 0,
                            fontWeight: "normal",
                            fontSize: "0.8rem",
                        },
                    },
                },
            },
            series: [
                {
                    name: "Records",
                    data: displayValues,
                    color: color,
                },
            ],
            credits: {enabled: false},
        };
    };

    const renderColumnChart = (containerId, categories, values, options = {}) => {
        const config = createColumnChartConfig(categories, values, options);
        Highcharts.chart(containerId, config);
    };

    const renderDonutChart = (containerId, chartData, total, options = {}) => {
        const {title = "", totalLabel = "Total", seriesName = "Registrations"} = options;

        drawDonutChart([
            {
                container: containerId,
                title: title,
                data: chartData,
                total: total,
                totalLabel: totalLabel,
                seriesName: seriesName,
            },
        ]);
    };

    const renderTable = (tableId, data, columns) => {
        const tableElement = document.querySelector(`#${tableId}`);
        if (!tableElement) {
            console.warn(`Table with id "${tableId}" not found`);
            return;
        }

        const thead = tableElement.querySelector("thead");
        const tbody = tableElement.querySelector("tbody");

        if (thead) {
            const theadRow = thead.querySelector("tr") || document.createElement("tr");
            theadRow.innerHTML = "";

            columns.forEach((col) => {
                const th = document.createElement("th");
                th.textContent = col.label || col.key;
                theadRow.appendChild(th);
            });

            if (!thead.querySelector("tr")) {
                thead.appendChild(theadRow);
            }
        }

        if (tbody) {
            tbody.innerHTML = "";

            data.forEach((row, index) => {
                const tr = document.createElement("tr");
                if (index % 2 === 0) {
                    tr.classList.add("odd");
                }

                columns.forEach((col) => {
                    const td = document.createElement("td");
                    const value = row[col.key] || "";
                    td.textContent = value;
                    if (col.className) {
                        td.classList.add(col.className);
                    }
                    tr.appendChild(td);
                });

                tbody.appendChild(tr);
            });
        }
    };

    // ==================== SPECIFIC RENDER FUNCTIONS ====================
    const renderColChart3 = async (fromDate = "", toDate = "") => {
        const data = await fetchTopRejectData("MaterialType", 0, 20, fromDate, toDate);
        if (data.length === 0) return;

        const sortedData = sortDataByRecord(data);
        const topData = getTopRecords(sortedData, 10);
        const {categories, values} = prepareColumnChartData(topData, "materialType", "numberRecord");

        renderColumnChart("col-chart-3", categories, values);
    };

    const renderColChart4 = async (fromDate = "", toDate = "") => {
        const data = await getMfrData(fromDate, toDate);
        if (data.length === 0) return;

        const sortedData = sortDataByRecord(data);
        const topData = getTopRecords(sortedData, 10);
        const {categories, values} = prepareColumnChartData(topData, "mfrname", "numberRecord");

        renderColumnChart("col-chart-4", categories, values);
    };

    const renderColChart5 = async (fromDate = "", toDate = "") => {
        const data = await fetchTopRejectData("model", 0, 20, fromDate, toDate);
        if (data.length === 0) return;

        const sortedData = sortDataByRecord(data);
        const topData = getTopRecords(sortedData, 10);
        const {categories, values} = prepareColumnChartData(topData, "model", "numberRecord");

        renderColumnChart("col-chart-5", categories, values);
    };

    const renderTable1 = async (fromDate = "", toDate = "") => {
        const data = await fetchTopRejectData("tadm", 0, 20, fromDate, toDate);
        if (data.length === 0) return;

        const sortedData = sortDataByRecord(data);
        const topData = getTopRecords(sortedData, 10);

        renderTable("table-1", topData, [
            {key: "materialType", label: "Material Type"},
            {key: "mfrcode", label: "MRF Code"},
            {key: "mfrname", label: "MFR Name"},
            {key: "numberRecord", label: "Num. of records"},
        ]);
    };

    const renderTable2 = async (fromDate = "", toDate = "") => {
        const data = await getMfrData(fromDate, toDate);
        if (data.length === 0) return;

        const sortedData = sortDataByRecord(data);
        const topData = getTopRecords(sortedData, 10);

        const mappedData = mapTableData(topData, {materialType: null});

        renderTable("table-2", mappedData, [
            {key: "materialType", label: "Material Type"},
            {key: "mfrcode", label: "MRF Code"},
            {key: "mfrname", label: "MFR Name"},
            {key: "numberRecord", label: "Num. of records"},
        ]);
    };

    const renderTable3 = async (fromDate = "", toDate = "") => {
        const data = await fetchTopRejectData("mandm", 0, 20, fromDate, toDate);
        if (data.length === 0) return;

        const sortedData = sortDataByRecord(data);
        const topData = getTopRecords(sortedData, 10);

        const mappedData = mapTableData(topData, {materialType: "model"});

        renderTable("table-3", mappedData, [
            {key: "materialType", label: "Material Type"},
            {key: "mfrcode", label: "MRF Code"},
            {key: "mfrname", label: "MFR Name"},
            {key: "numberRecord", label: "Num. of records"},
        ]);
    };

    // ==================== MAIN LOAD FUNCTION ====================
    const loadData = async (fromDate = "", toDate = "") => {
        highchartsInit();

        await Promise.all([
            renderColChart3(fromDate, toDate),
            renderColChart4(fromDate, toDate),
            renderColChart5(fromDate, toDate),
            renderTable1(fromDate, toDate),
            renderTable2(fromDate, toDate),
            renderTable3(fromDate, toDate),
        ]);
    };

    const loadEvent = () => {};

    const highchartsInit = () => {
        Highcharts.setOptions({
            chart: {
                backgroundColor: "transparent",
                spacing: [10, 5, 5, 5],
            },

            xAxis: {
                gridLineWidth: 1,
                gridLineColor: "#313f62",
                gridLineDashStyle: "Dash",
                lineWidth: 1,
                lineColor: "#313f62",
                lineDashStyle: "ShortDash",
                labels: {
                    style: {
                        fontSize: "1rem",
                        fontWeight: "600",
                        color: "#7a95c3",
                    },
                },
            },

            yAxis: {
                gridLineWidth: 1,
                gridLineColor: "#313f62",
                gridLineDashStyle: "Dash",
                labels: {
                    style: {
                        fontSize: "1rem",
                        fontWeight: "600",
                        color: "#7a95c3",
                    },
                },
            },

            tooltip: {
                outside: true,
                style: {
                    fontSize: "1rem",
                },
            },

            credits: {
                enabled: false,
            },

            plotOptions: {
                series: {
                    borderWidth: 0,
                    dataLabels: {
                        enabled: true,
                        style: {
                            color: "#fff",
                            textOutline: 0,
                            fontWeight: "normal",
                            fontSize: "1rem",
                        },
                    },
                },
            },
        });
    };

    function drawDonutChart(configs) {
        configs.forEach((cfg) => {
            Highcharts.chart(cfg.container, {
                chart: {
                    type: "pie",
                    custom: {},
                    events: {
                        render() {
                            const chart = this,
                                series = chart.series[0];
                            let customLabel = chart.options.chart.custom.label;
                            const totalValue =
                                typeof cfg.total !== "undefined"
                                    ? cfg.total
                                    : cfg.data.reduce((sum, d) => sum + (typeof d.y === "number" ? d.y : 0), 0);

                            if (!customLabel) {
                                customLabel = chart.options.chart.custom.label = chart.renderer
                                    .label(
                                        (cfg.totalLabel ? cfg.totalLabel + "<br/>" : "Total<br/>") +
                                            `<strong>${Highcharts.numberFormat(totalValue, 0, ".", " ")}</strong>`
                                    )
                                    .css({
                                        color: "var(--highcharts-neutral-color-100, #000)",
                                        textAnchor: "middle",
                                    })
                                    .add();
                            }

                            const x = series.center[0] + chart.plotLeft,
                                y = series.center[1] + chart.plotTop - customLabel.attr("height") / 2;

                            customLabel.attr({x, y});
                            customLabel.css({
                                fontSize: `${series.center[2] / 12}px`,
                            });
                        },
                    },
                },
                accessibility: {
                    point: {valueSuffix: "%"},
                },
                title: {text: cfg.title || ""},
                subtitle: cfg.subtitle ? {text: cfg.subtitle} : undefined,
                tooltip: {pointFormat: "{series.name}: <b>{point.percentage:.0f}%</b>"},
                legend: {enabled: false},
                plotOptions: {
                    series: {
                        allowPointSelect: true,
                        cursor: "pointer",
                        borderRadius: 8,
                        dataLabels: [
                            {
                                enabled: true,
                                distance: 20,
                                format: "{point.name}",
                            },
                            {
                                enabled: true,
                                distance: -15,
                                format: "{point.percentage:.0f}%",
                                style: {fontSize: "0.9em"},
                            },
                        ],
                        showInLegend: true,
                    },
                },
                series: [
                    {
                        name: cfg.seriesName || "Registrations",
                        colorByPoint: true,
                        innerSize: "75%",
                        data: cfg.data,
                    },
                ],
            });
        });
    }

    document.addEventListener("DOMContentLoaded", () => {
        loadEvent();
        loadData();
    });
</script>
